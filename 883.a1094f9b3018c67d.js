"use strict";(self.webpackChunktrimurti_hardware_manager=self.webpackChunktrimurti_hardware_manager||[]).push([[883],{9883:(D,h,i)=>{i.r(h),i.d(h,{ReportsModule:()=>T});var F=i(177),y=i(8426),u=i(467),t=i(540),g=i(7772);let R=(()=>{class e{constructor(){}getSalesSummary(n){return(0,u.A)(function*(){const s=(yield g.db.bills.toArray()).filter(o=>!(n.from&&new Date(o.date)<new Date(n.from)||n.to&&new Date(o.date)>new Date(n.to))),c=s.reduce((o,a)=>o+(a.total||0),0),d=s.length,$=s.filter(o=>"cash"===o.paymentType).reduce((o,a)=>o+(a.total||0),0),w=s.filter(o=>"credit"===o.paymentType).reduce((o,a)=>o+(a.total||0),0),p=new Map;return s.forEach(o=>{o.items.forEach(a=>{const v=a.name,f=p.get(v)||{qty:0,amount:0};f.qty+=a.qty,f.amount+=a.qty*a.price,p.set(v,f)})}),{totalSales:c,transactions:d,cash:$,credit:w,topProducts:Array.from(p.entries()).map(([o,a])=>({name:o,qty:a.qty,amount:a.amount})).sort((o,a)=>a.amount-o.amount).slice(0,5),filtered:s}})()}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var l=i(4341);function S(e,m){if(1&e&&(t.j41(0,"li"),t.EFF(1),t.j41(2,"span",18),t.EFF(3),t.k0s()()),2&e){const n=m.$implicit;t.R7$(1),t.SpI(" ",n.name," "),t.R7$(2),t.Lme("\u20b9",n.amount," \u2022 ",n.qty," units")}}function j(e,m){if(1&e&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&e){const n=m.$implicit;t.R7$(1),t.E5c(" ",n.invoiceNo," \u2022 \u20b9",n.total," \u2022 ",n.customerName||"Walk-in"," ")}}const E=function(){return[]},k=[{path:"",redirectTo:"sales",pathMatch:"full"},{path:"sales",component:(()=>{class e{constructor(n){this.reports=n,this.summary={},this.dateRange="7"}ngOnInit(){var n=this;return(0,u.A)(function*(){yield n.load()})()}load(){var n=this;return(0,u.A)(function*(){const r=new Date,s=new Date;s.setDate(r.getDate()-(Number(n.dateRange)||7));const c=yield n.reports.getSalesSummary({from:s.toISOString(),to:r.toISOString()});n.summary=c})()}static{this.\u0275fac=function(r){return new(r||e)(t.rXU(R))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-sales-report"]],decls:54,vars:8,consts:[[1,"container","py-4"],[1,"card","p-3","mb-3"],[1,"row","g-2","align-items-center"],[1,"col-md-3"],[1,"form-select",3,"ngModel","ngModelChange","change"],["value","7"],["value","30"],["value","365"],[1,"col-md-9","text-end"],[1,"btn","btn-primary"],[1,"row","g-3"],[1,"card","p-3","text-center"],[1,"fw-bold"],[1,"row","mt-3"],[1,"col-md-6"],[1,"card","p-3"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"float-end"]],template:function(r,s){1&r&&(t.j41(0,"div",0)(1,"h4"),t.EFF(2,"Sales Report"),t.k0s(),t.j41(3,"div",1)(4,"div",2)(5,"div",3)(6,"select",4),t.bIt("ngModelChange",function(d){return s.dateRange=d})("change",function(){return s.load()}),t.j41(7,"option",5),t.EFF(8,"This Week"),t.k0s(),t.j41(9,"option",6),t.EFF(10,"This Month"),t.k0s(),t.j41(11,"option",7),t.EFF(12,"This Year"),t.k0s()()(),t.j41(13,"div",8)(14,"button",9),t.EFF(15,"Export Report"),t.k0s()()()(),t.j41(16,"div",10)(17,"div",3)(18,"div",11)(19,"small"),t.EFF(20,"Total Sales"),t.k0s(),t.j41(21,"div",12),t.EFF(22),t.k0s()()(),t.j41(23,"div",3)(24,"div",11)(25,"small"),t.EFF(26,"Transactions"),t.k0s(),t.j41(27,"div",12),t.EFF(28),t.k0s()()(),t.j41(29,"div",3)(30,"div",11)(31,"small"),t.EFF(32,"Cash Sales"),t.k0s(),t.j41(33,"div",12),t.EFF(34),t.k0s()()(),t.j41(35,"div",3)(36,"div",11)(37,"small"),t.EFF(38,"Credit Sales"),t.k0s(),t.j41(39,"div",12),t.EFF(40),t.k0s()()()(),t.j41(41,"div",13)(42,"div",14)(43,"div",15)(44,"h6"),t.EFF(45,"Top Selling Products"),t.k0s(),t.j41(46,"ul",16),t.DNE(47,S,4,3,"li",17),t.k0s()()(),t.j41(48,"div",14)(49,"div",15)(50,"h6"),t.EFF(51,"Recent Transactions"),t.k0s(),t.j41(52,"ul",16),t.DNE(53,j,2,3,"li",17),t.k0s()()()()()),2&r&&(t.R7$(6),t.Y8G("ngModel",s.dateRange),t.R7$(16),t.SpI("\u20b9",s.summary.totalSales||0,""),t.R7$(6),t.JRh(s.summary.transactions||0),t.R7$(6),t.SpI("\u20b9",s.summary.cash||0,""),t.R7$(6),t.SpI("\u20b9",s.summary.credit||0,""),t.R7$(7),t.Y8G("ngForOf",s.summary.topProducts),t.R7$(6),t.Y8G("ngForOf",(s.summary.filtered||t.lJ4(7,E)).slice(0,6)))},dependencies:[F.Sq,l.xH,l.y7,l.wz,l.BC,l.vS],encapsulation:2})}}return e})()}];let C=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[y.iI.forChild(k),y.iI]})}}return e})(),T=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[F.MD,l.YN,C]})}}return e})()}}]);